# Use a base image with Python 3.12
FROM python:3.12-slim

# Set the working directory
WORKDIR /app

# Copy environment.yml to the container
COPY environment.yml .

# Install Conda
RUN apt-get update && \
    apt-get install -y wget bzip2 && \
    wget -O ~/miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh && \
    bash ~/miniconda.sh -b -p /opt/conda && \
    rm ~/miniconda.sh && \
    /opt/conda/bin/conda init bash

# Add Conda to PATH
ENV PATH="/opt/conda/bin:$PATH"

# Create and activate the Conda environment
RUN conda env create -f environment.yml

# Activate the environment
RUN echo "source activate transcribe" > ~/.bashrc
ENV PATH /opt/conda/envs/transcribe/bin:$PATH

# Install FFmpeg
RUN apt-get update && apt-get install -y ffmpeg

# Install additional Python dependencies using pip
RUN pip install --no-cache-dir openai-whisper yt-dlp

# Copy the application code into the container
COPY . .

# Specify the entrypoint for the container
CMD ["bash"]
